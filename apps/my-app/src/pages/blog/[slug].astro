---
import { GetStaticPaths } from "astro";
import { getCollection, getEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import BlogLayout from "../../layouts/BlogLayout.astro";

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  return blogEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect('/404');
}

const entry = await getEntry('blog', slug);

if (!entry) {
  return Astro.redirect('/404');
}

const { Content } = await entry.render();

const LAYOUTS = {
  blog: BlogLayout,
  default: Layout,
} as const;

const LayoutComponent = LAYOUTS[entry.data.layout];
---

<LayoutComponent>
    <h1>{entry.data.title}</h1>
    <Content />
</LayoutComponent>
